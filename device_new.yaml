config:
  register_address_type: u8
  default_byte_order: BE
  defmt_feature: "defmt"

# --- Power Control Registers (0x00 - 0x3F, some are reserved) ---
PowerStatus: # REG00H
  type: register
  address: 0x00
  size_bits: 8
  access: RO
  description: |
    Indicates the input power source status (ACIN, VBUS), battery current direction,
    and other power-related conditions.
  fields:
    acin_present:
      base: bool
      start: 7
      description: "ACIN physical presence status (true: voltage detected, false: no voltage detected)."
    acin_usable:
      base: bool
      start: 6
      description: "ACIN usability status (true: ACIN voltage is valid for system use, false: ACIN voltage is not valid/sufficient)."
    vbus_present:
      base: bool
      start: 5
      description: "VBUS physical presence status (true: voltage detected, false: no voltage detected)."
    vbus_usable:
      base: bool
      start: 4
      description: "VBUS usability status (true: VBUS voltage is valid for system use, false: VBUS voltage is not valid/sufficient)."
    vbus_voltage_above_vhold_when_connected:
      base: bool
      start: 3
      description: "Indicates if VBUS voltage was greater than VHOLD when VBUS was connected (true: VBUS > VHOLD, false: VBUS <= VHOLD or not applicable)."
    battery_is_charging:
      base: bool
      start: 2
      description: "Battery current direction (true: Battery is Charging, false: Battery is Discharging)."
    acin_and_vbus_inputs_shorted_on_pcb:
      base: bool
      start: 1
      description: "Indicates if ACIN and VBUS inputs are short-circuited on the PCB (true: short-circuited detected, false: no short-circuit)."
    boot_source_was_acin_or_vbus:
      base: bool
      start: 0
      description: "Indicates if the boot-up power source was ACIN or VBUS (true: boot from ACIN/VBUS, false: boot from Battery or other)."

ChargeStatus: # REG01H
  type: register
  address: 0x01
  size_bits: 8
  access: RO
  description: |
    Indicates various operational modes and charging statuses, including AXP192 temperature,
    battery presence, and charging progress.
  fields:
    axp192_over_temperature:
      base: bool
      start: 7
      description: "AXP192 over-temperature status (true: over-temperature, false: normal temperature)."
    charging_in_progress:
      base: bool
      start: 6
      description: "Charging progress status (true: charging is in progress, false: not charging or charge complete)."
    battery_connected:
      base: bool
      start: 5
      description: "Battery connection status (true: battery is connected, false: no battery connected)."
    # Bit 4 is reserved.
    battery_in_activation_mode:
      base: bool
      start: 3
      description: "Battery activation mode status (true: battery is in activation mode, false: not in activation mode)."
    charge_current_less_than_expected:
      base: bool
      start: 2
      description: "Indicates if actual charging current is less than the set/expected current (true: actual < expected, false: actual >= expected)."
    axp192_startup_mode_is_b:
      base: bool
      start: 1
      description: "AXP192 startup mode (true: Mode B, false: Mode A)."
    # Bit 0 is reserved.

OtgVbusStatus: # REG04H (Corrected from 02H based on summary table)
  type: register
  address: 0x04
  size_bits: 8
  access: RO
  description: "Indicates the status of VBUS when operating in USB OTG (On-The-Go) mode."
  fields:
    # Bits 7-3 are reserved.
    vbus_is_valid:
      base: bool
      start: 2
      description: "VBUS validity status in OTG mode (true: VBUS is valid, false: VBUS is not valid)."
    vbus_session_ab_is_valid:
      base: bool
      start: 1
      description: "VBUS Session A/B validity status (true: Session A/B is valid, false: Session A/B is not valid)."
    vbus_session_ended:
      base: bool
      start: 0
      description: "VBUS Session End status (true: Session has ended, false: Session is ongoing or not started)."

DataBuffer0: # REG06H
  type: register
  address: 0x06
  size_bits: 8
  access: RW
  reset_value: 0xF0
  description: |
    General purpose data buffer for system data storage.
    Note: Retained as long as any AXP192 power source is present (not affected by host on/off).
  fields:
    value:
      base: uint
      start: 0
      end: 8
      description: "8-bit data value."

DataBuffer1: # REG07H
  type: ref
  target: DataBuffer0
  override:
    type: register
    address: 0x07
    reset_value: 0x0F

DataBuffer2: # REG08H
  type: ref
  target: DataBuffer0
  override:
    type: register
    address: 0x08
    reset_value: 0x00

DataBuffer3: # REG09H
  type: ref
  target: DataBuffer0
  override:
    type: register
    address: 0x09
    reset_value: 0xFF

DataBuffer4: # REG0AH
  type: ref
  target: DataBuffer0
  override:
    type: register
    address: 0x0A
    reset_value: 0x00

DataBuffer5: # REG0BH
  type: ref
  target: DataBuffer0
  override:
    type: register
    address: 0x0B
    reset_value: 0x00

ExtenDcDc2Control: # REG10H
  type: register
  address: 0x10
  size_bits: 8
  access: RW
  reset_value: 0x05
  description: |
    Controls the output enable state for the EXTEN pin and the DC-DC2 converter.
  fields:
    # Bits 7-3 are reserved.
    exten_output_enable:
      base: bool
      start: 2
      description: "EXTEN pin output switch control (true: enabled/on, false: disabled/off)."
    # Bit 1 is reserved.
    dcdc2_output_enable:
      base: bool
      start: 0
      description: "DC-DC2 converter output switch control (true: enabled/on, false: disabled/off)."

PowerOutputControl: # REG12H
  type: register
  address: 0x12
  size_bits: 8
  access: RW
  reset_value: 0x5F
  description: |
    Controls output enable for DC-DC1, DC-DC3, LDO2, LDO3, and provides alternative controls for EXTEN and DC-DC2.
    IMPORTANT: REG12H bit 6 (exten_output_enable) is linked to REG10H bit 2.
                 REG12H bit 4 (dcdc2_output_enable) is linked to REG10H bit 0.
                 These pairs control the same underlying hardware function.
  fields:
    # Bit 7 is reserved.
    exten_output_enable:
      base: bool
      start: 6
      description: "EXTEN pin output switch control (true: enabled, false: disabled). Linked to REG10H[2]."
    # Bit 5 is reserved.
    dcdc2_output_enable:
      base: bool
      start: 4
      description: "DC-DC2 converter output switch control (true: enabled, false: disabled). Linked to REG10H[0]."
    ldo3_output_enable:
      base: bool
      start: 3
      description: "LDO3 output switch control (true: enabled, false: disabled)."
    ldo2_output_enable:
      base: bool
      start: 2
      description: "LDO2 output switch control (true: enabled, false: disabled)."
    dcdc3_output_enable:
      base: bool
      start: 1
      description: "DC-DC3 converter output switch control (true: enabled, false: disabled)."
    dcdc1_output_enable:
      base: bool
      start: 0
      description: "DC-DC1 converter output switch control (true: enabled, false: disabled)."

DcDc2VoltageSetting: # REG23H
  type: register
  address: 0x23
  size_bits: 8
  access: RW
  reset_value: 0x16 # Default 0x16 (bits 5-0 = 010110B = 22d) corresponds to 1.25V.
  description: |
    Sets the output voltage for the DC-DC2 converter.
    Formula: Output Voltage (V) = 0.7 + (voltage_setting_raw * 0.025).
    Effective range for voltage_setting_raw (bits 0-5): 0-63.
    Resulting voltage range: 0.7V to 2.275V, in 25mV steps.
  fields:
    # Bits 7-6 are reserved.
    voltage_setting_raw:
      base: uint
      start: 0
      end: 6 # 6 bits (0 to 5 inclusive)
      description: "Raw 6-bit value for DC-DC2 output voltage setting. See register description for conversion formula."

DcDc2VrcParameter: # REG25H
  type: register
  address: 0x25
  size_bits: 8
  access: RW
  reset_value: 0x00 # Default: VRC enabled (bit 2=0), Rise slope 1.6mV/us (bit 0=0)
  description: |
    Configures parameters for DC-DC2 Dynamic Voltage Scaling / Voltage Ramp Control (VRC),
    including VRC enable state and voltage rise slope.
  fields:
    # Bits 7-3 are reserved.
    vrc_disabled: # Naming reflects the bit's meaning: true if VRC is disabled
      base: bool
      start: 2
      description: "DC-DC2 VRC (Voltage Ramp Control) disable control (true: VRC disabled, false: VRC enabled). Note inverted logic."
    # Bit 1 is reserved.
    vrc_rise_slope_is_0_8mv_us: # Naming reflects the bit's meaning for true state
      base: bool
      start: 0
      description: "DC-DC2 VRC voltage rise slope (true: 0.8mV/us (25mV/31.25us), false: 1.6mV/us (25mV/15.625us))."

DcDc1VoltageSetting: # REG26H
  type: register
  address: 0x26
  size_bits: 8
  access: RW
  reset_value: 0x68 # Default 0x68 (bits 6-0 = 1101000B = 104d) corresponds to 3.3V.
  description: |
    Sets the output voltage for the DC-DC converter.
    Formula: Output Voltage (V) = 0.7 + (voltage_setting_raw * 0.025).
    Effective range for voltage_setting_raw (bits 0-6): 0-112 (decimal).
    Resulting voltage range: 0.7V to 3.5V, in 25mV steps.
    Values for voltage_setting_raw from 113 to 127 may be reserved or have undefined behavior.
  fields:
    # Bit 7 is reserved.
    voltage_setting_raw:
      base: uint
      start: 0
      end: 7 # 7 bits (0 to 6 inclusive)
      description: "Raw 7-bit value for DC-DC1 output voltage setting. See register description for conversion formula and valid range."

DcDc3VoltageSetting: # REG27H
  type: ref
  target: DcDc1VoltageSetting
  override:
    type: register
    address: 0x27
    reset_value: 0x48 # Default 0x48 (72d) corresponds to 2.5V for DC-DC3.

Ldo2And3VoltageSetting: # REG28H
  type: register
  address: 0x28
  size_bits: 8
  access: RW
  reset_value: 0xCF # Default: LDO2=3.0V (1100B), LDO3=3.3V (1111B)
  description: |
    Sets the output voltage for both LDO2 and LDO3.
    LDO2 (bits 7-4): Formula: V_out = 1.8V + (setting * 100mV). Range: 1.8V-3.3V.
    LDO3 (bits 3-0): Formula: V_out = 1.8V + (setting * 100mV). Range: 1.8V-3.3V.
  fields:
    ldo2_voltage_setting_raw:
      base: uint
      start: 4 # Bits 7-4
      end: 8   # 4 bits
      description: "Raw 4-bit setting for LDO2 output voltage (1.8V to 3.3V, 100mV/step)."
    ldo3_voltage_setting_raw:
      base: uint
      start: 0 # Bits 3-0
      end: 4   # 4 bits
      description: "Raw 4-bit setting for LDO3 output voltage (1.8V to 3.3V, 100mV/step)."

VbusIpsoutPathManagement: # REG30H
  type: register
  address: 0x30
  size_bits: 8
  access: RW
  reset_value: 0x80 # Default on M5StickC Plus: Path Forced Open (ignores N_VBUSEN),
                     # VHOLD limit OFF, VHOLD setting defaults to 4.0V (if enabled),
                     # VBUS current limit OFF (defaults to 500mA if enabled).
  description: |
    Manages the VBUS to IPSOUT path, VHOLD voltage limiting, and VBUS current limiting.
  fields:
    path_control_by_n_vbusen_pin:
      base: bool
      start: 7
      description: "VBUS-IPSOUT path selection control (true: path open regardless of N_VBUSEN, false: path controlled by N_VBUSEN pin)."
    vhold_voltage_limit_enabled: # Note: Datasheet REG30H[6] is '1' for limit enabled
      base: bool
      start: 6
      description: "VBUS VHOLD voltage limiting control (true: limit enabled, false: no limit)."
    vhold_voltage_setting_raw:
      base: uint
      start: 3
      end: 6 # 3 bits (3, 4, 5)
      description: |
        VHOLD voltage setting (000:4.0V, 001:4.1V, 010:4.2V, 011:4.3V, 100:4.4V, 101:4.5V, 110:4.6V, 111:4.7V).
        Raw value.
    # Bit 2 is reserved.
    vbus_current_limit_enabled:
      base: bool
      start: 1
      description: "VBUS current limit control (true: enabled, false: disabled)."
    vbus_current_limit_is_100ma: # true if 100mA, false if 500mA (when enabled)
      base: bool
      start: 0
      description: "VBUS current limit selection when enabled (true: 100mA, false: 500mA)."

ShutdownVoltageSetting: # REG31H
  type: register
  address: 0x31
  size_bits: 8
  access: RW
  reset_value: 0x03 # Default on M5StickC Plus: VOFF=2.9V, Sleep PWRON wakeup disabled.
  description: |
    Sets the VOFF (shutdown) voltage threshold and controls the PWRON short-press wakeup
    functionality when the device is in sleep mode.
    VOFF (bits 0-2) sets shutdown voltage: 000=2.6V ... 011(default)=2.9V ... 111=3.3V (100mV/step).
    SleepWakeupEnable (bit 3): Setting to 'true' enables wakeup, but this bit auto-clears.
  fields:
    # Bits 7-4 are reserved.
    sleep_pwron_short_press_wakeup_enable:
      base: bool
      start: 3
      description: "Enable PWRON short press to wake from sleep (true: enabled, false: disabled). Note: This bit auto-clears to 0 after being written as 1, requires re-setting before each sleep entry if wakeup is desired."
    voff_shutdown_voltage_setting_raw:
      base: uint
      start: 0
      end: 3 # 3 bits (0, 1, 2)
      description: |
        Raw 3-bit value for VOFF (shutdown) voltage setting.
        Mapping: 000=2.6V, 001=2.7V, 010=2.8V, 011=2.9V (default), 100=3.0V, 101=3.1V, 110=3.2V, 111=3.3V.

