config:
  register_address_type: u8
  default_byte_order: BE
  defmt_feature: "defmt"

# --- Power Control Registers (0x00 - 0x3F, some are reserved) ---
PowerStatus: # REG00H
  type: register
  address: 0x00
  size_bits: 8
  access: RO
  description: |
    Indicates the input power source status (ACIN, VBUS), battery current direction,
    and other power-related conditions.
  fields:
    acin_present:
      base: bool
      start: 7
      description: "ACIN physical presence status (true: voltage detected, false: no voltage detected)."
    acin_usable:
      base: bool
      start: 6
      description: "ACIN usability status (true: ACIN voltage is valid for system use, false: ACIN voltage is not valid/sufficient)."
    vbus_present:
      base: bool
      start: 5
      description: "VBUS physical presence status (true: voltage detected, false: no voltage detected)."
    vbus_usable:
      base: bool
      start: 4
      description: "VBUS usability status (true: VBUS voltage is valid for system use, false: VBUS voltage is not valid/sufficient)."
    vbus_voltage_above_vhold_when_connected:
      base: bool
      start: 3
      description: "Indicates if VBUS voltage was greater than VHOLD when VBUS was connected (true: VBUS > VHOLD, false: VBUS <= VHOLD or not applicable)."
    battery_flow:
      base: uint
      start: 2
      end: 3
      description: "Battery current direction."
      conversion:
        name: BatteryFlowDirection
        Discharging: { value: 0 }
        Charging:    { value: 1 }
    acin_and_vbus_inputs_shorted_on_pcb:
      base: bool
      start: 1
      description: "Indicates if ACIN and VBUS inputs are short-circuited on the PCB (true: short-circuited detected, false: no short-circuit)."
    boot_source_was_acin_or_vbus:
      base: bool
      start: 0
      description: "Indicates if the boot-up power source was ACIN or VBUS (true: boot from ACIN/VBUS, false: boot from Battery or other)."

ChargeStatus: # REG01H
  type: register
  address: 0x01
  size_bits: 8
  access: RO
  description: |
    Indicates various operational modes and charging statuses, including AXP192 temperature,
    battery presence, and charging progress.
  fields:
    axp192_over_temperature:
      base: bool
      start: 7
      description: "AXP192 over-temperature status (true: over-temperature, false: normal temperature)."
    charging_in_progress:
      base: bool
      start: 6
      description: "Charging progress status (true: charging is in progress, false: not charging or charge complete)."
    battery_connected:
      base: bool
      start: 5
      description: "Battery connection status (true: battery is connected, false: no battery connected)."
    # Bit 4 is reserved.
    battery_in_activation_mode:
      base: bool
      start: 3
      description: "Battery activation mode status (true: battery is in activation mode, false: not in activation mode)."
    charge_current_less_than_expected:
      base: bool
      start: 2
      description: "Indicates if actual charging current is less than the set/expected current (true: actual < expected, false: actual >= expected)."
    startup_mode:
      base: uint
      start: 1
      end: 2
      description: "AXP192 startup mode."
      conversion:
        name: AxpStartupMode
        ModeA: { value: 0, description: "Startup Mode A." }
        ModeB: { value: 1, description: "Startup Mode B." }
    # Bit 0 is reserved.

OtgVbusStatus: # REG04H
  type: register
  address: 0x04
  size_bits: 8
  access: RO
  description: "Indicates the status of VBUS when operating in USB OTG (On-The-Go) mode."
  fields:
    # Bits 7-3 are reserved.
    vbus_is_valid:
      base: bool
      start: 2
      description: "VBUS validity status in OTG mode (true: VBUS is valid, false: VBUS is not valid)."
    vbus_session_ab_is_valid:
      base: bool
      start: 1
      description: "VBUS Session A/B validity status (true: Session A/B is valid, false: Session A/B is not valid)."
    vbus_session_ended:
      base: bool
      start: 0
      description: "VBUS Session End status (true: Session has ended, false: Session is ongoing or not started)."

DataBuffer0: # REG06H
  type: register
  address: 0x06
  size_bits: 8
  access: RW
  reset_value: 0xF0
  description: |
    General purpose data buffer for system data storage.
    Note: Retained as long as any AXP192 power source is present (not affected by host on/off).
  fields:
    value:
      base: uint
      start: 0
      end: 8
      description: "8-bit data value."

DataBuffer1: # REG07H
  type: ref
  target: DataBuffer0
  override:
    type: register
    address: 0x07
    reset_value: 0x0F

DataBuffer2: # REG08H
  type: ref
  target: DataBuffer0
  override:
    type: register
    address: 0x08
    reset_value: 0x00

DataBuffer3: # REG09H
  type: ref
  target: DataBuffer0
  override:
    type: register
    address: 0x09
    reset_value: 0xFF

DataBuffer4: # REG0AH
  type: ref
  target: DataBuffer0
  override:
    type: register
    address: 0x0A
    reset_value: 0x00

DataBuffer5: # REG0BH
  type: ref
  target: DataBuffer0
  override:
    type: register
    address: 0x0B
    reset_value: 0x00

ExtenDcDc2Control: # REG10H
  type: register
  address: 0x10
  size_bits: 8
  access: RW
  reset_value: 0x05 # Default on M5StickC Plus: EXTEN ON, DCDC2 ON
  description: |
    Controls the output enable state for the EXTEN pin and the DC-DC2 converter.
  fields:
    # Bits 7-3 are reserved.
    exten_output_enable:
      base: bool
      start: 2
      description: "EXTEN pin output switch control (true: enabled/on, false: disabled/off)."
    # Bit 1 is reserved.
    dcdc2_output_enable:
      base: bool
      start: 0
      description: "DC-DC2 converter output switch control (true: enabled/on, false: disabled/off)."

PowerOutputControl: # REG12H
  type: register
  address: 0x12
  size_bits: 8
  access: RW
  reset_value: 0x5F # Default on M5StickC Plus: All outputs are ON.
  description: |
    Controls output enable for DC-DC1, DC-DC3, LDO2, LDO3, EXTEN, and DC-DC2.
    Power-on default for M5StickC Plus is 0x5F.
    IMPORTANT: REG12H bit 6 (exten_output_enable) is linked to REG10H bit 2.
                 REG12H bit 4 (dcdc2_output_enable) is linked to REG10H bit 0.
                 These pairs control the same underlying hardware function.
  fields:
    # Bit 7 is reserved.
    exten_output_enable:
      base: bool
      start: 6
      description: "EXTEN pin output switch control (true: enabled, false: disabled). Linked to REG10H[2]."
    # Bit 5 is reserved.
    dcdc2_output_enable:
      base: bool
      start: 4
      description: "DC-DC2 converter output switch control (true: enabled, false: disabled). Linked to REG10H[0]."
    ldo3_output_enable:
      base: bool
      start: 3
      description: "LDO3 output switch control (true: enabled, false: disabled)."
    ldo2_output_enable:
      base: bool
      start: 2
      description: "LDO2 output switch control (true: enabled, false: disabled)."
    dcdc3_output_enable:
      base: bool
      start: 1
      description: "DC-DC3 converter output switch control (true: enabled, false: disabled)."
    dcdc1_output_enable:
      base: bool
      start: 0
      description: "DC-DC1 converter output switch control (true: enabled, false: disabled)."

DcDc2VoltageSetting: # REG23H
  type: register
  address: 0x23
  size_bits: 8
  access: RW
  reset_value: 0x16 # Default 0x16 (22d) corresponds to 1.25V.
  description: |
    Sets the output voltage for the DC-DC2 converter.
    Formula: Output Voltage (V) = 0.7 + (value * 0.025). Range: 0.7V to 2.275V (raw 0-63).
  fields:
    # Bits 7-6 are reserved.
    voltage_setting:
      base: uint
      start: 0
      end: 6

DcDc2VrcParameter: # REG25H
  type: register
  address: 0x25
  size_bits: 8
  access: RW
  reset_value: 0x00 # Default: VRC enabled (bit 2=0), Rise slope 1.6mV/us (bit 0=0)
  description: |
    Configures DC-DC2 Dynamic Voltage Scaling / Voltage Ramp Control (VRC).
  fields:
    # Bits 7-3 are reserved.
    vrc_disabled:
      base: bool
      start: 2
      description: "DC-DC2 VRC disable control (true: VRC disabled, false: VRC enabled). Note inverted logic."
    # Bit 1 is reserved.
    vrc_rise_slope:
      base: uint
      start: 0
      end: 1
      description: "DC-DC2 VRC voltage rise slope."
      conversion:
        name: VrcRiseSlope
        Slope1_6mV_us: { value: 0, description: "1.6mV/us slope."}
        Slope0_8mV_us: { value: 1, description: "0.8mV/us slope."}

DcDc1VoltageSetting: # REG26H
  type: register
  address: 0x26
  size_bits: 8
  access: RW
  reset_value: 0x68 # Default 0x68 (104d) corresponds to 3.3V.
  description: |
    Sets the output voltage for a DC-DC converter.
    Formula: V_out = 0.7V + (value * 25mV). Range 0.7V-3.5V (raw 0-112).
  fields:
    # Bit 7 is reserved.
    voltage_setting:
      base: uint
      start: 0
      end: 7

DcDc3VoltageSetting: # REG27H
  type: ref
  target: DcDc1VoltageSetting
  override:
    type: register
    address: 0x27
    reset_value: 0x48 # Default 0x48 (72d) corresponds to 2.5V for DC-DC3.

Ldo2And3VoltageSetting: # REG28H
  type: register
  address: 0x28
  size_bits: 8
  access: RW
  reset_value: 0xCF # Default: LDO2=3.0V, LDO3=3.3V
  description: |
    Sets the output voltage for both LDO2 and LDO3.
    LDO2 (bits 7-4) & LDO3 (bits 3-0): V_out = 1.8V + (setting * 100mV). Range: 1.8V-3.3V.
  fields:
    ldo2_voltage_setting:
      base: uint
      start: 4
      end: 8
      description: "4-bit setting for LDO2 output voltage (1.8V to 3.3V, 100mV/step)."
    ldo3_voltage_setting:
      base: uint
      start: 0
      end: 4
      description: "4-bit setting for LDO3 output voltage (1.8V to 3.3V, 100mV/step)."

VbusIpsoutPathManagement: # REG30H
  type: register
  address: 0x30
  size_bits: 8
  access: RW
  reset_value: 0x80 # Default on M5StickC Plus: Path Forced Open (ignores N_VBUSEN),
                    # VHOLD limit OFF, VHOLD setting defaults to 4.0V (if enabled),
                    # VBUS current limit OFF (defaults to 500mA if enabled).
  description: |
    Manages VBUS to IPSOUT path, VHOLD voltage limiting, and VBUS current limiting.
  fields:
    path_selection_override:
      base: uint
      start: 7
      end: 8
      description: "VBUS-IPSOUT path selection control."
      conversion:
        name: VbusPathSelectionControl
        ControlledByNvbusenPin: { value: 0, description: "Path controlled by N_VBUSEN pin." }
        ForcedOpen:             { value: 1, description: "Path forced open (ignores N_VBUSEN)." }
    vhold_limit_enabled:
      base: bool
      start: 6
      description: "VBUS VHOLD voltage limiting control (true: limit enabled, false: no limit)."
    vhold_voltage:
      base: uint
      start: 3
      end: 6
      description: "VHOLD voltage setting when vhold_limit_enabled is true."
      conversion:
        name: VholdVoltageValue
        V4_0: { value: 0b000, description: "4.0V" } # Default
        V4_1: { value: 0b001, description: "4.1V" }
        V4_2: { value: 0b010, description: "4.2V" }
        V4_3: { value: 0b011, description: "4.3V" }
        V4_4: { value: 0b100, description: "4.4V" }
        V4_5: { value: 0b101, description: "4.5V" }
        V4_6: { value: 0b110, description: "4.6V" }
        V4_7: { value: 0b111, description: "4.7V" }
    # Bit 2 is reserved.
    vbus_current_limit_enabled:
      base: bool
      start: 1
      description: "VBUS current limit control (true: enabled, false: disabled)."
    vbus_current_limit:
      base: uint
      start: 0
      end: 1
      description: "VBUS current limit selection when vbus_current_limit_enabled is true."
      conversion:
        name: VbusCurrentLimitValue
        Ma500: { value: 0, description: "500mA limit."} # Default
        Ma100: { value: 1, description: "100mA limit."}

ShutdownVoltageSetting: # REG31H
  type: register
  address: 0x31
  size_bits: 8
  access: RW
  reset_value: 0x03 # Default on M5StickC Plus: VOFF=2.9V, Sleep PWRON wakeup disabled.
  description: |
    Sets VOFF (shutdown) voltage and PWRON short-press wakeup from sleep.
  fields:
    # Bits 7-4 are reserved.
    sleep_pwron_short_press_wakeup_enable:
      base: bool
      start: 3
      description: "Enable PWRON short press to wake from sleep (true: enabled, false: disabled). Auto-clears."
    voff_voltage:
      base: uint
      start: 0
      end: 3
      description: "VOFF (shutdown) voltage threshold."
      conversion:
        name: VoffVoltageValue
        V2_6: { value: 0b000, description: "2.6V" }
        V2_7: { value: 0b001, description: "2.7V" }
        V2_8: { value: 0b010, description: "2.8V" }
        V2_9: { value: 0b011, description: "2.9V" } # Default
        V3_0: { value: 0b100, description: "3.0V" }
        V3_1: { value: 0b101, description: "3.1V" }
        V3_2: { value: 0b110, description: "3.2V" }
        V3_3: { value: 0b111, description: "3.3V" }

ShutdownBatChgLedControl: # REG32H
  type: register
  address: 0x32
  size_bits: 8
  access: RW
  reset_value: 0x46 # Default: Bat mon ON, CHGLED by charge func (default high-Z if by reg), N_OE delay 2S.
  description: |
    Controls shutdown, battery detection, CHGLED pin, and N_OE shutdown delay.
  fields:
    request_shutdown_mode_a:
      base: bool
      start: 7
      description: "Initiate AXP192 shutdown in Mode A (true: request shutdown)."
    battery_monitoring_enable:
      base: bool
      start: 6
      description: "Battery monitoring function (true: enabled, false: disabled)."
    chgled_function:
      base: uint
      start: 4
      end: 6
      description: "CHGLED pin function when chgled_control_source is ByRegister."
      conversion:
        name: ChgLedFunctionSetting
        HighZ:     { value: 0b00, description: "High Impedance." } # Default
        Blink1Hz:  { value: 0b01, description: "1Hz blink (25% duty)." }
        Blink4Hz:  { value: 0b10, description: "4Hz blink (25% duty)." }
        OutputLow: { value: 0b11, description: "Output Low." }
    chgled_control_source:
      base: uint
      start: 3
      end: 4
      description: "CHGLED pin control source."
      conversion:
        name: ChgLedControlSourceSelect
        ByChargeLogic:     { value: 0, description: "Controlled by charging function." } # Default
        ByRegisterSetting: { value: 1, description: "Controlled by this register's chgled_function field." }
    # Bit 2 is reserved.
    n_oe_shutdown_delay:
      base: uint
      start: 0
      end: 2
      description: "Shutdown delay after N_OE pin transitions from low to high."
      conversion:
        name: NoeShutdownDelayValue
        Ms500: { value: 0b00, description: "0.5S delay." }
        S1:    { value: 0b01, description: "1S delay." }
        S2:    { value: 0b10, description: "2S delay." } # Default
        S3:    { value: 0b11, description: "3S delay." }

ChargeControl1: # REG33H
  type: register
  address: 0x33
  size_bits: 8
  access: RW
  reset_value: 0xC8 # Default: Charging ON, Target 4.2V, End at 10% current, Current 780mA.
  description: |
    Controls primary charging parameters.
  fields:
    charge_enable:
      base: bool
      start: 7
      description: "Charging function enable (true: enabled, false: disabled)."
    target_voltage:
      base: uint
      start: 5
      end: 7
      description: "Charging target voltage setting."
      conversion:
        name: ChargeTargetVoltageValue
        V4_10: { value: 0b00, description: "4.10V" }
        V4_15: { value: 0b01, description: "4.15V" }
        V4_20: { value: 0b10, description: "4.20V" } # Default
        V4_36: { value: 0b11, description: "4.36V" }
    end_current_threshold:
      base: uint
      start: 4
      end: 5
      description: "Charge termination current threshold."
      conversion:
        name: ChargeEndCurrentThresholdValue
        Percent10: { value: 0, description: "Terminate at <10% of set current." } # Default
        Percent15: { value: 1, description: "Terminate at <15% of set current." }
    charge_current:
      base: uint
      start: 0
      end: 4
      description: "Internal path charging current setting."
      conversion:
        name: ChargeCurrentValue
        MA100:  { value: 0b0000, description: "100mA" }
        MA190:  { value: 0b0001, description: "190mA" }
        MA280:  { value: 0b0010, description: "280mA" }
        MA360:  { value: 0b0011, description: "360mA" }
        MA450:  { value: 0b0100, description: "450mA" }
        MA550:  { value: 0b0101, description: "550mA" }
        MA630:  { value: 0b0110, description: "630mA" }
        MA700:  { value: 0b0111, description: "700mA" }
        MA780:  { value: 0b1000, description: "780mA" } # Default
        MA880:  { value: 0b1001, description: "880mA" }
        MA960:  { value: 0b1010, description: "960mA" }
        MA1000: { value: 0b1011, description: "1000mA" }
        MA1080: { value: 0b1100, description: "1080mA" }
        MA1160: { value: 0b1101, description: "1160mA" }
        MA1240: { value: 0b1110, description: "1240mA" }
        MA1320: { value: 0b1111, description: "1320mA" }

ChargeControl2: # REG34H
  type: register
  address: 0x34
  size_bits: 8
  access: RW
  reset_value: 0x41 # Default: Precharge 40min, ExtPathCurrent 300mA, ExtPathCharge OFF, CC Timeout 8Hrs.
  description: |
    Controls secondary charging parameters including pre-charge timeout,
    external path charge current and enable state, and constant current mode timeout.
  fields:
    precharge_timeout:
      base: uint
      start: 6
      end: 8 # 2 bits (6, 7)
      description: "Pre-charge phase timeout duration."
      conversion:
        name: PrechargeTimeoutValue
        Min30: { value: 0b00, description: "30 minutes timeout." }
        Min40: { value: 0b01, description: "40 minutes timeout." } # Default
        Min50: { value: 0b10, description: "50 minutes timeout." }
        Min60: { value: 0b11, description: "60 minutes timeout." }
    external_path_charge_current:
      base: uint
      start: 3
      end: 6 # 3 bits (3, 4, 5)
      description: "External path charging current setting (300mA to 1000mA, 100mA/step)."
      conversion:
        name: ExternalPathChargeCurrentValue
        MA300:  { value: 0b000, description: "300mA" } # Default
        MA400:  { value: 0b001, description: "400mA" }
        MA500:  { value: 0b010, description: "500mA" }
        MA600:  { value: 0b011, description: "600mA" }
        MA700:  { value: 0b100, description: "700mA" }
        MA800:  { value: 0b101, description: "800mA" }
        MA900:  { value: 0b110, description: "900mA" }
        MA1000: { value: 0b111, description: "1000mA" }
    external_path_charge_enable:
      base: bool
      start: 2
      description: "External path charging enable (true: enabled, false: disabled)." # Default: false
    constant_current_timeout:
      base: uint
      start: 0
      end: 2 # 2 bits (0, 1)
      description: "Constant Current (CC) charging mode timeout duration."
      conversion:
        name: ConstantCurrentTimeoutValue
        Hours7: { value: 0b00, description: "7 hours timeout." }
        Hours8: { value: 0b01, description: "8 hours timeout." } # Default
        Hours9: { value: 0b10, description: "9 hours timeout." }
        Hours10: { value: 0b11, description: "10 hours timeout." }

